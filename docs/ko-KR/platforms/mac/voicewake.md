---
summary: "macOS 앱의 음성 웨이크 및 푸시 투 토크 모드와 라우팅 세부정보"
read_when:
  - 음성 웨이크 또는 PTT 경로 작업 시
title: "음성 웨이크"
---

# 음성 웨이크 및 푸시 투 토크

## 모드

- **웨이크 워드 모드** (기본값): 상시 작동 음성 인식기가 트리거 토큰(`swabbleTriggerWords`)을 기다립니다. 일치하면 캡처를 시작하고 부분 텍스트가 있는 오버레이를 표시하며 무음 후 자동으로 전송합니다.
- **푸시 투 토크 (Right Option 유지)**: 오른쪽 Option 키를 누르고 있으면 트리거 없이 즉시 캡처합니다. 키를 누르고 있는 동안 오버레이가 나타나며, 놓으면 짧은 지연 후 완료되고 전달되므로 텍스트를 조정할 수 있습니다.

## 런타임 동작 (웨이크 워드)

- 음성 인식기는 `VoiceWakeRuntime`에 있습니다.
- 트리거는 웨이크 워드와 다음 단어 사이에 **의미 있는 일시정지**가 있을 때만 실행됩니다(약 0.55초 간격). 명령이 시작되기 전에도 일시정지에서 오버레이/차임이 시작될 수 있습니다.
- 무음 윈도우: 음성이 흐를 때 2.0초, 트리거만 들렸을 때 5.0초.
- 하드 스톱: 120초로 무한 세션 방지.
- 세션 간 디바운스: 350ms.
- 오버레이는 커밋된/휘발성 색상으로 `VoiceWakeOverlayController`를 통해 구동됩니다.
- 전송 후 인식기가 깔끔하게 재시작되어 다음 트리거를 수신합니다.

## 라이프사이클 불변성

- 음성 웨이크가 활성화되고 권한이 부여된 경우 웨이크 워드 인식기가 수신 대기해야 합니다(명시적 푸시 투 토크 캡처 중 제외).
- 오버레이 가시성(X 버튼을 통한 수동 닫기 포함)이 인식기 재개를 방해해서는 안 됩니다.

## 고정 오버레이 실패 모드 (이전)

이전에는 오버레이가 표시된 상태로 고정되고 수동으로 닫으면 오버레이 가시성으로 인해 런타임의 재시작 시도가 차단될 수 있고 후속 재시작이 예약되지 않아 음성 웨이크가 "죽은" 것처럼 보일 수 있었습니다.

강화:

- 웨이크 런타임 재시작이 더 이상 오버레이 가시성으로 차단되지 않습니다.
- 오버레이 닫기 완료가 `VoiceSessionCoordinator`를 통해 `VoiceWakeRuntime.refresh(...)`를 트리거하므로 수동 X-닫기가 항상 수신을 재개합니다.

## 푸시 투 토크 세부사항

- 핫키 감지는 **오른쪽 Option**(`keyCode 61` + `.option`)에 대한 전역 `.flagsChanged` 모니터를 사용합니다. 이벤트만 관찰합니다(삼키지 않음).
- 캡처 파이프라인은 `VoicePushToTalk`에 있습니다: 즉시 음성을 시작하고 부분을 오버레이로 스트리밍하며 놓을 때 `VoiceWakeForwarder`를 호출합니다.
- 푸시 투 토크가 시작되면 경쟁하는 오디오 탭을 피하기 위해 웨이크 워드 런타임을 일시 중지하며, 놓은 후 자동으로 재시작됩니다.
- 권한: 마이크 + 음성 필요, 이벤트 표시에는 접근성/입력 모니터링 승인 필요.
- 외부 키보드: 일부는 오른쪽 Option을 예상대로 노출하지 않을 수 있습니다. 사용자가 누락을 보고하면 대체 단축키를 제공합니다.

## 사용자 대면 설정

- **음성 웨이크** 토글: 웨이크 워드 런타임을 활성화합니다.
- **Cmd+Fn을 누르고 말하기**: 푸시 투 토크 모니터를 활성화합니다. macOS < 26에서는 비활성화됩니다.
- 언어 및 마이크 선택기, 실시간 레벨 미터, 트리거 워드 테이블, 테스터 (로컬 전용, 전달하지 않음).
- 마이크 선택기는 디바이스가 연결 해제된 경우 마지막 선택을 유지하고 연결 해제된 힌트를 표시하며 다시 돌아올 때까지 임시로 시스템 기본값으로 대체합니다.
- **사운드**: 트리거 감지 및 전송 시 차임, 기본값은 macOS "Glass" 시스템 사운드입니다. 각 이벤트에 대해 `NSSound` 로드 가능한 파일(예: MP3/WAV/AIFF)을 선택하거나 **사운드 없음**을 선택할 수 있습니다.

## 전달 동작

- 음성 웨이크가 활성화되면 전사본이 활성 게이트웨이/에이전트로 전달됩니다(macOS 앱의 나머지 부분에서 사용하는 것과 동일한 로컬 또는 원격 모드).
- 응답은 **마지막으로 사용한 메인 프로바이더**(WhatsApp/Telegram/Discord/WebChat)로 전달됩니다. 전달이 실패하면 오류가 기록되고 실행은 여전히 WebChat/세션 로그를 통해 볼 수 있습니다.

## 전달 페이로드

- `VoiceWakeForwarder.prefixedTranscript(_:)`는 전송 전에 머신 힌트를 앞에 추가합니다. 웨이크 워드와 푸시 투 토크 경로 간에 공유됩니다.

## 빠른 검증

- 푸시 투 토크를 켜고 Cmd+Fn을 누르고 말하고 놓습니다: 오버레이가 부분을 표시한 다음 전송해야 합니다.
- 누르고 있는 동안 메뉴 바 귀가 확대된 상태로 유지되어야 합니다(`triggerVoiceEars(ttl:nil)` 사용), 놓으면 내려갑니다.
